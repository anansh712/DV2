<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
<style>
  html, body {
    margin:0;
    padding:0;
    background:#fff;
    overflow:hidden;          /* ðŸ”’ no scroll inside iframe */
    font-family: system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
  }
  #vis {
    width:100%;
    height:100%;
    min-height:400px;         /* target height */
  }
</style>
</head>
<body>
<div id="vis"></div>

<script>
const TOPO_URL = "https://raw.githubusercontent.com/anansh712/DV2/main/Datasets/aus_states.json";
const CSV_URL  = "https://raw.githubusercontent.com/anansh712/DV2/main/Datasets/obesity_by_state.csv";

fetch(TOPO_URL).then(r => r.json()).then(topology => {
  const featureKey = Object.keys(topology.objects || {})[0];

  const projection = {
  type: "mercator",
  center: [135, -25],
  scale: 450,              // â†“ smaller scale to fit full map in 400Ã—400 frame
  translate: [200, 200]    // centers it nicely within the smaller viewport
};

  const sphere = {
    data:{ sphere:true },
    mark:{ type:"geoshape", fill:"#e9f5ff" },
    projection
  };

  const graticule = {
    data:{ graticule:true },
    mark:{ type:"geoshape", stroke:"#cfd8dc", strokeWidth:0.5, opacity:0.7 },
    projection
  };

  const base = {
    data:{ url:TOPO_URL, format:{ type:"topojson", feature:featureKey } },
    mark:{ type:"geoshape", fill:"#f2f2f2", stroke:"#cfcfcf", strokeWidth:0.7 },
    projection
  };

  const choropleth = {
    data:{ url:TOPO_URL, format:{ type:"topojson", feature:featureKey } },
    transform:[
      { calculate:"datum.properties.name || datum.properties.name_en", as:"state_name" },
      { filter:
        "datum.state_name != 'Coral Sea Islands' && " +
        "datum.state_name != 'Jervis Bay Territory' && " +
        "datum.state_name != 'Ashmore and Cartier Islands'"
      },
      {
        lookup:"state_name",
        from:{ data:{ url:CSV_URL }, key:"State", fields:["Obese (%)"] }
      }
    ],
    mark:{ type:"geoshape", stroke:"white", strokeWidth:0.8 },
    encoding:{
      color:{
        field:"Obese (%)",
        type:"quantitative",
        title:"Obesity (%)",
        scale:{
          type:"threshold",
          domain:[27,29,31,33,35],
          range:["#f7fcf5","#c7e9c0","#74c476","#238b45","#005a32","#00341f"]
        },
        legend:{
          labelFormat:".1f",
          gradientLength:80,
          orient:"right",
          titleFontSize:11,
          labelFontSize:10
        }
      },
      tooltip:[
        { field:"state_name", title:"State" },
        { field:"Obese (%)", type:"quantitative", title:"Obesity (%)", format:".1f" }
      ]
    },
    projection
  };

  const labels = {
    data:{ url:TOPO_URL, format:{ type:"topojson", feature:featureKey } },
    transform:[
      { calculate:"datum.properties.name || datum.properties.name_en", as:"state_name" },
      { filter:
        "datum.state_name != 'Coral Sea Islands' && " +
        "datum.state_name != 'Jervis Bay Territory' && " +
        "datum.state_name != 'Ashmore and Cartier Islands'"
      },
      { calculate:"datum.properties.longitude", as:"lon" },
      { calculate:"datum.properties.latitude",  as:"lat" },
      { calculate:
        "datum.state_name == 'New South Wales' ? 'NSW' :" +
        "datum.state_name == 'Victoria' ? 'VIC' :" +
        "datum.state_name == 'Queensland' ? 'QLD' :" +
        "datum.state_name == 'South Australia' ? 'SA' :" +
        "datum.state_name == 'Western Australia' ? 'WA' :" +
        "datum.state_name == 'Tasmania' ? 'TAS' :" +
        "datum.state_name == 'Northern Territory' ? 'NT' :" +
        "datum.state_name == 'Australian Capital Territory' ? 'ACT' :" +
        "datum.state_name",
        as:"abbr"
      }
    ],
    mark:{ type:"text", fontSize:10, fontWeight:"bold", dy:2, fill:"#0b2239" },
    encoding:{
      longitude:{ field:"lon" },
      latitude:{ field:"lat" },
      text:{ field:"abbr" }
    },
    projection
  };

  const spec = {
    $schema:"https://vega.github.io/schema/vega-lite/v5.json",
    width:530,
    height:400,
    layer:[sphere, graticule, base, choropleth, labels],
    config:{ view:{ stroke:null } }
  };

  vegaEmbed("#vis", spec, {actions:false});
});
</script>
</body>
</html>